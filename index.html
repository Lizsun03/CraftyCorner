<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link 
      href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&family=Playwrite+NO:wght@100..400&display=swap"
      rel="stylesheet"
      />
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrollable Main Page</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="overlay"></div>
    <div class="head-foot-container">
        <div class="header-container">
            <h1 class="logo">Crafty Corner</h1>
            <div class="search-bar">
                <input type="text" id = "textbox" placeholder="Search...">
                <button class="search-button">
                    <i class="fa-solid fa-magnifying-glass"></i>
                </button>
            </div>
            <div class="icons-container">
                <div class="icon">
                    <img
                        src="images/favorites-icon.svg"
                        alt="profile icon"
                        class="profile-image"
                    />
                </div>
                <div class="icon">
                    <img
                        src="images/profileIcon2.png"
                        alt="profile icon"
                        class="profile-image"
                    />
                </div>
            </div>
        </div>

        <div class="fixed-buttons">
            <a href="messages.html">
                <img
                    src="images/messageIcon.svg"
                    alt="message icon"
                    class="message-icon"
                />
            </a>
            <a href="addItem.html">
                <img
                    src="images/addIcon.svg"
                    alt="add icon"
                    class="add-icon"
                />
            </a>
        </div>
    </div>
    

    <div class="container">
        <div class="labels">
            <label class = "label-item">
                <input type="checkbox" id="Material" />
                <span for="material"> Material </span>
            </label>

            <label class = "label-item">
                <input type="checkbox" id="color" />
                <span for="color"> Color </span>
            </label>

            <label class = "label-item">
                <input type="checkbox" id="quantity" />
                <span for="quantity"> Quantity </span>
            </label>

            <label class = "label-item">
                <input type="checkbox" id="Conditon" />
                <span for="condition"> Condition </span>
            </label>

            <label class = "label-item">
                <input type="checkbox" id="Price" />
                <span for="price"> Price </span>
            </label>
        </div>
        
        <div class="grid" id = "items-grid">
            <!-- this is where the displayItems does its magic -->
        </div>
    </div>
    <div class="side-panel">
        <button class="side-panel-close" type="button">Ã—</button>
        <h2 class="side-title">Side Panel</h2>
        <img src="images/content-images/glue.jpg" alt="Image" id="image-id">
        <p class="side-panel-content">Select a box to see its description.</p>
    </div>
    <script>
        
        //if side panel is clicked closed
        const boxes = document.querySelectorAll('.box');
        for (box of boxes) {
            const title = box.querySelector('.box-title').textContent;
            const description = box.querySelector('.box-description').textContent;
            const imageURL = document.getElementById("image-id").src="/images/save.png";
            box.addEventListener('click', () => {
                document.querySelector(".side-title").textContent = title;
                document.querySelector(".side-panel-content").textContent = description;
                document.querySelector(".side-panel").classList.toggle("side-panel-open");
                document.querySelector(".overlay").classList.add("overlay-active");
            });
        }
        document.querySelector(".side-panel-close").addEventListener("click", () => {
            
            document.querySelector(".side-panel").classList.remove("side-panel-open");
            document.querySelector(".overlay").classList.remove("overlay-active");
        });
        
        //adds the relevant items into the grid. 
        document.addEventListener('DOMContentLoaded', async() =>  {
            const response = await fetch('database.json');
            const items = await response.json();
            console.log("fetched items");
            const itemsGrid = document.getElementById("items-grid");
            
            //display the items (boxes)
            console.log("displaying all items:", items);
            displayItems(items);
            // function that displays the items
            function displayItems(displayItems) {
                const itemsGrid = document.getElementById('items-grid');
                const errorMessage = document.getElementById('error');
                itemsGrid.innerHTML = '';

                for (var key in displayItems) {
                    // hasOwnProperty checks if the json object has filtered property, key. Key can be like the ID or it can be some logic
                    if (displayItems.hasOwnProperty(key)) {
                        const item = displayItems[key];
                        //debug
                        console.log('Display item: ', item);
                        const itemBox = document.createElement('div');
                        itemBox.className = 'box';
                        itemBox.innerHTML =  `
                        <div class="top-half">
                            <img src="${item.ImageURL}" alt="Image of ${item.Name}" class="round-top-corners">
                        </div>
                        <div class="bottom-half">
                            <div class="box-title"> ${item.Name} </div>
                                <div class="box-description"> ${item.Description} </div>
                        </div>
                        
                        `;
                        itemsGrid.appendChild(itemBox);

                    } 
                }

            }


            //go through search response
            const searchButton = document.querySelector('.search-button');
           

            searchButton.addEventListener("click", async() => {
                
                const searchQuery = document.getElementById('textbox').value.toLowerCase();
                console.log('searchQuery is: ', searchQuery);

                const response = await fetch('database.json');
                const json = await response.json();
                const filtered = {};

                for (var key in json) {
                    if (json.hasOwnProperty(key) && json[key].Name.toLowerCase().includes(searchQuery)) {
                        console.log('filtering...');
                        filtered[key] = json[key];
                    }       
                }
                //give error if there are no relevant results.
                if (Object.keys(filtered).length == 0) {
                    alert("I'm sorry, we are unable to find items related to your search.");
                }
                
                displayItems(filtered);
            });


        });
    
    

    </script>

   
</body>
</html>
