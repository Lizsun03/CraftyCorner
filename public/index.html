<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link 
      href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&family=Playwrite+NO:wght@100..400&display=swap"
      rel="stylesheet"
      />
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrollable Main Page</title>
    <link rel="stylesheet" href="style.css">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href=
"https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" />

    <!-- Bootstrap Font Icon CSS -->
    <link rel="stylesheet" href=
"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" />

    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" data-backdrop="false">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Favorites</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Item1</p>
                    <p>Item2</p>
                    <p>Item3</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and dependencies (Popper.js and jQuery) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


    <div class="overlay"></div>
    <div class="head-foot-container">
        <div class="header-container">
            <div class="icon">
                <img
                    src="images/logo.svg"
                    alt="logo"
                    class="logo"
                />
                <h1 class="title">Crafty Corner</h1>
            </div>
            <div class="search-bar">
                <input type="text" id = "textbox" placeholder="Search...">
                <button class="search-button">
                    <i class="fa-solid fa-magnifying-glass"></i>
                </button>
            </div>
            <div class="icons-container">
                <div class="icon">
                    <button type="button" data-toggle="modal" data-target="#exampleModal" style="border: none; background-color: #FFFDF5;">
                        <img
                            src="Images/favorites-icon.svg"
                            alt="favorites icon"
                            class="favorites-image"
                        />
                    </button>
                    
                </div>
                <div class="icon">
                    <a href="profile.html">
                        <img
                        src="Images/profileIcon2.png"
                        alt="profile icon"
                        class="profile-image"
                    />
                    </a>
                </div>
            </div>
        </div>

        <div class="fixed-buttons">
            <a href="messages.html">
                <img
                    src="Images/messageIcon.svg"
                    alt="message icon"
                    class="message-icon"
                />
            </a>
            <a href="addItem.html">
                <img
                    src="Images/addIcon.svg"
                    alt="add icon"
                    class="add-icon"
                />
            </a>
        </div>
    </div>
    

    <div class="container">
        <div class="labels">
            
            <div class="dropdown">
                <button id="color" class="orange label" onclick="drop('color', 'color-dropdown', 'color-caret')">
                    Color
                    <i id="color-caret" class="bi bi-caret-down-fill"></i>
                </button>
                <div id="color-dropdown" class="dropdown-content">
                    <div class="orange dropdown-label">Red</div>
                    <div class="orange dropdown-label">Blue</div>
                    <div class="orange dropdown-label">Yellow</div>
                    <div class="orange dropdown-label">Green</div>
                    <div class="orange dropdown-label">Orange</div>
                    <div class="orange dropdown-label">Purple</div>
                    <div class="orange dropdown-label">Pink</div>
                    <div class="orange dropdown-label">Black</div>
                    <div class="orange dropdown-label">White</div>
                </div>
            </div>

            <div class="dropdown">
                <button id="quantity" class="green label" onclick="drop('quantity', 'quantity-dropdown', 'quantity-caret')">
                    Quantity
                    <i id="quantity-caret" class="bi bi-caret-down-fill"></i>
                </button>
                <div id="quantity-dropdown" class="dropdown-content">
                    <div class="green dropdown-label">Small</div>
                    <div class="green dropdown-label">Medium</div>
                    <div class="green dropdown-label">Big</div>
                    <div class="green dropdown-label">Really Big</div>
                </div>
            </div>

            <div class="dropdown">
                <button id="condition" class="lightblue label" onclick="drop('condition', 'condition-dropdown', 'condition-caret')">
                    Condition
                    <i id="condition-caret" class="bi bi-caret-down-fill"></i>
                     
                </button>
                <div id="condition-dropdown" class="dropdown-content">
                    <div class="lightblue dropdown-label">New</div>
                    <div class="lightblue dropdown-label">Almost New</div>
                    <div class="lightblue dropdown-label">Average</div>
                    <div class="lightblue dropdown-label">Fair</div>
                    <div class="lightblue dropdown-label">Poor</div>
                </div>
            </div>

            <div class="dropdown">
                <button id="price" class="pink label" onclick="drop('price', 'price-dropdown', 'price-caret')">
                    Price
                    <i id="price-caret" class="bi bi-caret-down-fill"></i>
                </button>
                <div id="price-dropdown" class="dropdown-content">
                    <div class="pink dropdown-label">$0-$5</div>
                    <div class="pink dropdown-label">$5-$10</div>
                    <div class="pink dropdown-label">$10-$15</div>
                    <div class="pink dropdown-label">$15-$20</div>
                    <div class="pink dropdown-label">$20+</div>
                </div>
            </div>

            <div class="dropdown">
                <button id="material" class="blue label" onclick="drop('material', 'material-dropdown', 'material-caret')">
                    Material
                    <i id="material-caret" class="bi bi-caret-down-fill"></i>
                </button>
                <div id="material-dropdown" class="dropdown-content">
                    <div class="blue dropdown-label">Wood</div>
                    <div class="blue dropdown-label">Fabric</div>
                    <div class="blue dropdown-label">Plastic</div>
                    <div class="blue dropdown-label">Metal</div>
                    <div class="blue dropdown-label">Threads</div>
                </div>
            </div>
            
        </div>
        
        <div class="grid" id = "items-grid">
            <!-- this is where the displayItems does its magic -->
        </div>
    </div>
    <div class="side-panel">
        <button class="side-panel-close" type="button">Ã—</button>
        <h2 class="side-title">Side Panel</h2>
        <img src="images/content-images/glue.jpg" alt="Image" id="image-id">
        <p class="side-panel-content">Select a box to see its description.</p>
        <div class="side-panel-labels"></div>
    </div>

    <script>
        
        //dropdown
        function drop(buttonId, dropdownId, caretId) {
            console.log('drop called');
            var button = document.getElementById(buttonId);
            var dropdown = document.getElementById(dropdownId);
            var buttonWidth = window.getComputedStyle(button).width;
            var caret = document.getElementById(caretId);
            console.log(caret.classList);

            if (dropdown.style.display === "none" || dropdown.style.display === "") {
                button.style.borderBottomLeftRadius = "0";
                button.style.borderBottomRightRadius = "0";
                dropdown.style.display = "block";
                dropdown.style.width = buttonWidth;
                caret.classList.remove("bi bi-caret-down-fill");
                caret.classList.add("bi bi-caret-right-fill");
            } else {
                button.style.borderBottomLeftRadius = "12px";
                button.style.borderBottomRightRadius = "12px";
                dropdown.style.display = "none";
                caret.classList.remove("bi bi-caret-right-fill");
                caret.classList.add("bi bi-caret-down-fill");
            }
        }
        
        //adds the relevant items into the grid. 
        document.addEventListener('DOMContentLoaded', async() =>  {
            const response = await fetch('database.json');
            const items = await response.json();
            console.log("fetched items");
            const itemsGrid = document.getElementById("items-grid");
            
            //display the items (boxes)
            console.log("displaying all items:", items);
            displayItems(items);
            // function that displays the items
            function displayItems(displayItems) {
                const itemsGrid = document.getElementById('items-grid');
                const errorMessage = document.getElementById('error');
                itemsGrid.innerHTML = '';

                for (var key in displayItems) {
                    // hasOwnProperty checks if the json object has filtered property, key. Key can be like the ID or it can be some logic
                    if (displayItems.hasOwnProperty(key)) {
                        const item = displayItems[key];
                        const itemBox = document.createElement('div');
                        itemBox.className = 'box';
                        itemBox.innerHTML =  `
                            <div class="top-half">
                                <img src="${item.ImageURL}" alt="Image of ${item.Name}" class="round-top-corners">
                                </div>
                            <div class="bottom-half">
                                <div class="box-title"> ${item.Name} </div>
                                <div class="box-description"> ${item.Description}  </div>
                            </div>
                            <div class="display-tag">
                                    <div  class = "display-tag-item" id="price">  ${item.Labels.Price} </div>
                                    <div class = "display-tag-item" id="material">  ${item.Labels.Material}</div>
                                    <div class = "display-tag-item" id="quantity">  ${item.Labels.Quantity}</div>
                                    <div class = "display-tag-item" id="color">  ${item.Labels.Color}</div>
                                    <div class = "display-tag-item" id="condition">  ${item.Labels.Condition}</div>
                            </div>
                            </div>
                           
                        `;
                        itemsGrid.appendChild(itemBox);

                    }

                }
                //if side panel is clicked closed
                const boxes = document.querySelectorAll('.box');
                boxes.forEach(box => {
                    box.addEventListener('click', () => {
                        const title = box.querySelector('.box-title').textContent;
                        const description = box.querySelector('.box-description').textContent;
                        const imageSrc = box.querySelector('img').src;
                        const displayTags = box.querySelector('.display-tag').innerHTML; // Specific display-tag for this box

                        document.querySelector(".side-title").textContent = title;
                        document.querySelector(".side-panel-content").textContent = description;
                        document.querySelector("#image-id").src = imageSrc;
                        document.querySelector('.side-panel-labels').innerHTML = displayTags;

                        document.querySelector(".side-panel").classList.toggle("side-panel-open");
                        document.querySelector(".overlay").classList.add("overlay-active");
                    });
                });

                document.querySelector(".side-panel-close").addEventListener("click", () => {
                    document.querySelector(".side-panel").classList.remove("side-panel-open");
                    document.querySelector(".overlay").classList.remove("overlay-active");
                });
            }
            //go through search response
            const searchButton = document.querySelector('.search-button');
            searchButton.addEventListener("click", async() => {
                
                const searchQuery = document.getElementById('textbox').value.toLowerCase();
                console.log('searchQuery is: ', searchQuery);

                const response = await fetch('database.json');
                const json = await response.json();
                console.log("json file is: " , json);
                const filtered = {};

                for (var key in json) {
                    if (json.hasOwnProperty(key) && json[key] && typeof json[key].Name === 'string' && json[key].Name.toLowerCase().includes(searchQuery)) {
                        console.log('filtering...', json[key]);
                        filtered[key] = json[key];
                        console.log('current items', filtered)
                    }       
                }
                displayItems(filtered);
                console.log('filtered items', filtered)
                 //give error if there are no relevant results.
                 if (Object.keys(filtered).length == 0) {
                    alert("I'm sorry, we are unable to find items related to your search.");
                    displayItems(items); // reset to home
                }
               
            });
            



        });
    
    

    </script>

   
</body>
</html>